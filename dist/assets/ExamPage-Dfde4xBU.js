var se=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var Z=(s,t,n)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,Q=(s,t)=>{for(var n in t||(t={}))ae.call(t,n)&&Z(s,n,t[n]);if(Y)for(var n of Y(t))re.call(t,n)&&Z(s,n,t[n]);return s},z=(s,t)=>te(s,ne(t));var $=(s,t,n)=>new Promise((a,l)=>{var g=i=>{try{x(n.next(i))}catch(h){l(h)}},r=i=>{try{x(n.throw(i))}catch(h){l(h)}},x=i=>i.done?a(i.value):Promise.resolve(i.value).then(g,r);x((n=n.apply(s,t)).next())});import{r as o,j as e,b as ie}from"./vendor-CKlhejSV.js";import{r as P,a as ce,s as le,b as q,l as oe}from"./admin-_w2uFh8u.js";import"./html2canvas-CIV5arX1.js";import"./katex-DJtWuuRl.js";function de({examName:s,timeLeft:t,totalQuestions:n}){const{minutes:a,seconds:l,colorClass:g}=o.useMemo(()=>{const r=Math.floor(t/60),x=t%60;let i="timer-green";return t<300?i="timer-red":t<900&&(i="timer-yellow"),{minutes:String(r).padStart(2,"0"),seconds:String(x).padStart(2,"0"),colorClass:i}},[t]);return e.jsx("header",{className:"exam-header",children:e.jsxs("div",{className:"exam-header-content",children:[e.jsx("h1",{className:"exam-title bengali",children:s}),e.jsxs("div",{className:`timer ${g} bengali`,children:[a,":",l]})]})})}function ue(s,t,n=50){const a=o.useRef(null),l=o.useRef(null),g=n;return{onTouchStart:h=>{l.current=null,a.current=h.targetTouches[0].clientX},onTouchMove:h=>{l.current=h.targetTouches[0].clientX},onTouchEnd:()=>{if(!a.current||!l.current)return;const h=a.current-l.current,u=h>g,b=h<-g;u&&s&&s(),b&&t&&t()}}}function me({question:s,questionNumber:t,selectedAnswer:n,onAnswerSelect:a,onPrev:l,onNext:g,canGoPrev:r,canGoNext:x,isMarked:i,onToggleMark:h,onSubmit:u}){const b=ue(()=>x&&g(),()=>r&&l());return s?e.jsxs("div",z(Q({className:"question-card"},b),{children:[e.jsxs("div",{className:"question-header",children:[e.jsxs("span",{className:"question-badge bengali",children:["‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ",t]}),i&&e.jsx("span",{className:"review-badge bengali",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]}),e.jsx("div",{className:"question-text bengali",dangerouslySetInnerHTML:{__html:P(s.question)}}),s.hasDiagram&&s.svg_code&&e.jsx("div",{className:"question-diagram",dangerouslySetInnerHTML:{__html:s.svg_code}}),e.jsx("div",{className:"options-grid",children:s.options.map(m=>{const C=n===m.id;return e.jsxs("button",{className:`option-card ${C?"selected":""}`,onClick:()=>a(s.id,m.id),children:[e.jsxs("span",{className:"option-label",children:[m.id,")"]}),e.jsx("span",{className:"option-text bengali",dangerouslySetInnerHTML:{__html:P(m.text)}}),C&&e.jsx("span",{className:"check-icon",children:"‚úì"})]},m.id)})}),e.jsxs("div",{className:"question-actions",children:[e.jsxs("button",{className:"action-btn secondary",onClick:h,children:[i?"‚úì ":"",e.jsx("span",{className:"bengali",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsxs("button",{className:"action-btn",onClick:l,disabled:!r,children:["‚Üê ",e.jsx("span",{className:"bengali",children:"‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞"})]}),x?e.jsxs("button",{className:"action-btn primary",onClick:g,children:[e.jsx("span",{className:"bengali",children:"‡¶™‡¶∞‡ßá‡¶∞"})," ‚Üí"]}):e.jsx("button",{className:"action-btn primary submit-btn",onClick:u,children:e.jsx("span",{className:"bengali",children:"‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü"})})]})]})]})):null}function he({totalQuestions:s,currentIndex:t,answers:n,questions:a,visitedQuestions:l,markedQuestions:g,onQuestionJump:r}){function x(i){const h=a[i];if(!h)return"unvisited";const u=n[h.id]!==void 0,b=l.has(i),m=g.has(i);return i===t?"active":m?"marked":u?"answered":b?"visited":"unvisited"}return e.jsxs("aside",{className:"sidebar-grid",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h3",{className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶®"}),e.jsxs("div",{className:"status-legend-grid",children:[e.jsxs("div",{className:"status-item unvisited",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶Ö‡¶¶‡ßá‡¶ñ‡¶æ"})]}),e.jsxs("div",{className:"status-item visited",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶¶‡ßá‡¶ñ‡¶æ"})]}),e.jsxs("div",{className:"status-item answered",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞"})]}),e.jsxs("div",{className:"status-item marked",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]})]})]}),e.jsx("div",{className:"questions-grid",children:Array.from({length:s},(i,h)=>{const u=x(h);return e.jsx("button",{className:`question-bubble ${u}`,onClick:()=>r(h),title:`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${h+1}`,children:h+1},h)})})]})}function ee({status:s,retryCount:t,nextRetryIn:n,error:a}){const[l,g]=o.useState(!0),[r,x]=o.useState(!1);if(o.useEffect(()=>{if(s==="success"){const m=setTimeout(()=>{g(!1)},3e3);return()=>clearTimeout(m)}else g(!0)},[s]),o.useEffect(()=>{x(!1)},[s]),s==="idle"||s==="success"&&!l||r)return null;const i=()=>{x(!0)},h=()=>{switch(s){case"success":return"‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá";case"submitting":return t===0?"‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...":`‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá (${t})...`;case"retrying":return`‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ${Math.ceil(n/1e3)} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá... (‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ${t}/10)`;case"failed":return"‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";default:return"‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."}},u=()=>{switch(s){case"success":return null;case"submitting":return null;case"retrying":return null;case"failed":return null;default:return null}},b=s==="failed"?"error":s==="retrying"?"warning":s==="success"?"success":"info";return e.jsxs("div",{className:`submission-status ${b}`,children:[e.jsxs("div",{className:"submission-status-content",children:[u()&&e.jsx("span",{className:"submission-icon",children:u()}),e.jsx("span",{className:"submission-text bengali",children:h()}),e.jsx("button",{className:"submission-close-btn",onClick:i,"aria-label":"Close notification",children:"√ó"})]}),s==="retrying"&&e.jsx("div",{className:"submission-progress",children:e.jsx("div",{className:"progress-bar",style:{animationDuration:`${n}ms`}})})]})}function ge({score:s,accuracy:t}){const a=t>=90?{type:"gold",icon:"G",title:"‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£ ‡¶™‡¶¶‡¶ï",subtitle:"‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£!",gradient:"var(--gradient-gold)"}:t>=75?{type:"silver",icon:"S",title:"‡¶∞‡ßå‡¶™‡ßç‡¶Ø ‡¶™‡¶¶‡¶ï",subtitle:"‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞!",gradient:"var(--gradient-silver)"}:t>=60?{type:"bronze",icon:"B",title:"‡¶¨‡ßç‡¶∞‡ßã‡¶û‡ßç‡¶ú ‡¶™‡¶¶‡¶ï",subtitle:"‡¶≠‡¶æ‡¶≤‡ßã!",gradient:"var(--gradient-bronze)"}:{type:"participation",icon:"P",title:"‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£",subtitle:"‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®!",gradient:"var(--gradient-primary)"};return e.jsxs("div",{className:`achievement-badge ${a.type}`,children:[e.jsx("div",{className:"badge-glow"}),e.jsx("div",{className:"badge-icon",children:a.icon}),e.jsxs("div",{className:"badge-content",children:[e.jsx("div",{className:"badge-title bengali",children:a.title}),e.jsx("div",{className:"badge-subtitle bengali",children:a.subtitle})]})]})}function xe({correct:s,wrong:t,unanswered:n}){const a=o.useRef(null),l=s+t+n;return o.useEffect(()=>{const g=a.current;if(!g)return;const r=g.getContext("2d"),x=g.width/2,i=g.height/2,h=70;r.clearRect(0,0,g.width,g.height);const u=s/l*2*Math.PI,b=t/l*2*Math.PI;let m=-Math.PI/2;s>0&&(r.beginPath(),r.arc(x,i,h,m,m+u),r.lineTo(x,i),r.fillStyle="#10b981",r.fill(),m+=u),t>0&&(r.beginPath(),r.arc(x,i,h,m,m+b),r.lineTo(x,i),r.fillStyle="#ef4444",r.fill(),m+=b),n>0&&(r.beginPath(),r.arc(x,i,h,m,m+n/l*2*Math.PI),r.lineTo(x,i),r.fillStyle="#9ca3af",r.fill()),r.beginPath(),r.arc(x,i,h-30,0,2*Math.PI),r.fillStyle="white",r.fill()},[s,t,n,l]),e.jsxs("div",{className:"performance-chart",children:[e.jsx("h3",{className:"chart-title bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¨‡¶®‡ßç‡¶ü‡¶®"}),e.jsxs("div",{className:"chart-container",children:[e.jsx("canvas",{ref:a,width:"200",height:"200",className:"chart-canvas"}),e.jsxs("div",{className:"chart-center",children:[e.jsx("div",{className:"chart-total",children:l}),e.jsx("div",{className:"chart-label bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®"})]})]}),e.jsxs("div",{className:"chart-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot correct"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï (",s,")"]})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot wrong"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶≠‡ßÅ‡¶≤ (",t,")"]})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot unanswered"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶® (",n,")"]})]})]})]})}function fe({questions:s,answers:t,studentName:n,score:a,onRestart:l,questionFile:g,submissionStatus:r}){const{score:x,correct:i,wrong:h,attempted:u,total:b}=a,m=u>0?(i/u*100).toFixed(1):0,C=b-u,k=x>=40,[v,M]=o.useState([]),[I,T]=o.useState(null),[N,j]=o.useState("all"),[A,y]=o.useState(0),[_,D]=o.useState(0),U=o.useRef(!1);o.useEffect(()=>{J(),U.current||(U.current=!0,B(y,i),B(D,h))},[]);function B(f,S){const p=S/30;let E=0;const w=setInterval(()=>{E+=p,E>=S?(f(S),clearInterval(w)):f(Math.floor(E))},1e3/30)}function J(){return $(this,null,function*(){try{const c=(g||"questions.json").replace(".json","").replace(/\s+/g,"")+"-Answer.json",d=yield fetch(`/${c}`,{cache:"no-store"});if(!d.ok)return;const p=yield d.json();M(p)}catch(f){console.log("Could not load solutions:",f)}})}function H(f){var S;return((S=v.find(c=>c.id===f||c.id.toString()===f.toString()))==null?void 0:S.solution)||null}function V(f){T(I===f?null:f)}function F(){return m>=90?"‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£! ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßã!":m>=75?"‡¶ñ‡ßÅ‡¶¨ ‡¶≠‡¶æ‡¶≤‡ßã! ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú!":m>=60?"‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶∞‡ßá‡¶õ‡ßã! ‡¶è‡¶ó‡¶ø‡¶Ø‡¶º‡ßá ‡¶ö‡¶≤‡ßã!":k?"‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßá‡¶õ‡ßã! ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!":"‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ‡¶§‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶≠‡¶æ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá!"}function O(){return s.filter(f=>{const S=t[f.id],c=S===f.correctOptionId,d=S!==void 0;return N==="correct"?c:N==="wrong"?d&&!c:N==="unanswered"?!d:!0})}return e.jsxs("div",{className:"result-summary",children:[e.jsxs("div",{className:"result-card",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("h1",{className:"bengali",children:"‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®"}),e.jsx("p",{className:"student-name bengali",children:n}),e.jsx("p",{className:"congratulations-message bengali",children:F()})]}),e.jsx(ge,{score:x,accuracy:parseFloat(m)}),e.jsxs("div",{className:"score-and-chart-container",children:[e.jsxs("div",{className:`score-display ${k?"pass":"fail"}`,children:[e.jsxs("div",{className:"progress-ring",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 200 200",children:[e.jsx("circle",{className:"progress-circle-bg",cx:"100",cy:"100",r:"85"}),e.jsx("circle",{className:"progress-circle",cx:"100",cy:"100",r:"85",style:{strokeDasharray:`${x/b*534} 534`}})]}),e.jsxs("div",{className:"score-content",children:[e.jsx("div",{className:"score-value",children:x.toFixed(2)}),e.jsxs("div",{className:"score-label bengali",children:["‡¶Æ‡ßã‡¶ü: ",b]})]})]}),e.jsx("div",{className:`status-badge ${k?"pass":"fail"}`,children:k?"‡¶™‡¶æ‡¶∏":"‡¶´‡ßá‡¶≤"})]}),e.jsx(xe,{correct:i,wrong:h,unanswered:C})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item correct-stat",children:[e.jsx("div",{className:"stat-value correct",children:A}),e.jsx("div",{className:"stat-label bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï"})]}),e.jsxs("div",{className:"stat-item wrong-stat",children:[e.jsx("div",{className:"stat-value wrong",children:_}),e.jsx("div",{className:"stat-label bengali",children:"‡¶≠‡ßÅ‡¶≤"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:u}),e.jsx("div",{className:"stat-label bengali",children:"‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsxs("div",{className:"stat-value",children:[m,"%"]}),e.jsx("div",{className:"stat-label bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï‡¶§‡¶æ"})]})]}),e.jsxs("div",{className:"answers-review",children:[e.jsx("h2",{className:"bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ"}),e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:`filter-btn ${N==="all"?"active":""}`,onClick:()=>j("all"),children:e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶¨ (",s.length,")"]})}),e.jsx("button",{className:`filter-btn ${N==="correct"?"active":""}`,onClick:()=>j("correct"),children:e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï (",i,")"]})}),e.jsx("button",{className:`filter-btn ${N==="wrong"?"active":""}`,onClick:()=>j("wrong"),children:e.jsxs("span",{className:"bengali",children:["‡¶≠‡ßÅ‡¶≤ (",h,")"]})}),e.jsx("button",{className:`filter-btn ${N==="unanswered"?"active":""}`,onClick:()=>j("unanswered"),children:e.jsxs("span",{className:"bengali",children:["‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶® (",C,")"]})})]}),e.jsx("div",{className:"answers-list",children:O().map((f,S)=>{const c=t[f.id],d=c===f.correctOptionId,p=c!==void 0;return e.jsxs("div",{className:`answer-item ${d?"correct":p?"wrong":"unanswered"}`,children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("span",{className:"question-num bengali",children:["‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ",S+1]}),d&&e.jsx("span",{className:"icon-check"}),p&&!d&&e.jsx("span",{className:"icon-cross"}),!p&&e.jsx("span",{className:"icon-dash"})]}),e.jsx("div",{className:"question-text bengali",children:f.question}),e.jsx("div",{className:"answer-details",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"bengali",children:["‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞: ",c]}),e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ",f.correctOptionId]})]}):e.jsx("span",{className:"bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø"})}),H(f.id)&&e.jsxs("div",{className:"solution-toggle-section",children:[e.jsx("button",{className:"solution-toggle-btn bengali",onClick:()=>V(f.id),children:I===f.id?"‚ñº ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®":"‚ñ∂ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®"}),I===f.id&&e.jsxs("div",{className:"solution-box",children:[e.jsx("div",{className:"solution-header bengali",children:e.jsx("strong",{children:"‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®/‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ"})}),e.jsx("div",{className:"solution-text bengali",children:H(f.id)})]})]})]},f.id)})})]}),e.jsx("button",{className:"restart-btn bengali",onClick:l,children:"‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}),e.jsx(ee,Q({},r))]})}const L="exam_submission_queue",K=10,pe=2e3;function be(s){const t=G(),n=`${s.studentName}_${Date.now()}`,a={id:n,payload:s,timestamp:new Date().toISOString(),retryCount:0,status:"pending"};return t.push(a),localStorage.setItem(L,JSON.stringify(t)),console.log("üìù Queued submission:",n),n}function G(){try{const s=localStorage.getItem(L);return s?JSON.parse(s):[]}catch(s){return console.error("Failed to load submission queue:",s),[]}}function je(s){const n=G().filter(a=>a.id!==s);localStorage.setItem(L,JSON.stringify(n)),console.log("‚úÖ Cleared submission from queue:",s)}function X(s,t){const a=G().map(l=>l.id===s?Q(Q({},l),t):l);localStorage.setItem(L,JSON.stringify(a))}function ve(s){return Math.min(pe*Math.pow(2,s),6e4)}function W(s,t){return $(this,null,function*(){const{id:n,payload:a,retryCount:l=0}=s;if(l>=K)return console.error("‚ùå Max retries reached for:",n),X(n,{status:"failed",lastError:"Max retries exceeded"}),t==null||t({status:"failed",retryCount:l,error:"Max retries exceeded"}),{success:!1,error:"Max retries exceeded"};try{t==null||t({status:"submitting",retryCount:l});try{yield ce(a.studentName),console.log("‚úì Removed from pending list:",a.studentName)}catch(r){console.warn("Could not remove from pending list (continuing):",r.message)}const g=yield le(a);return je(n),t==null||t({status:"success",retryCount:l}),console.log("‚úÖ Submission successful:",n),{success:!0,result:g}}catch(g){console.warn(`‚ö†Ô∏è Submission failed (attempt ${l+1}/${K}):`,g.message);const r=l+1;if(X(n,{retryCount:r,lastError:g.message,lastAttempt:new Date().toISOString()}),r<K){const x=ve(r);return t==null||t({status:"retrying",retryCount:r,nextRetryIn:x}),yield new Promise(i=>setTimeout(i,x)),W(z(Q({},s),{retryCount:r}),t)}else return X(n,{status:"failed"}),t==null||t({status:"failed",retryCount:r,error:g.message}),{success:!1,error:g.message}}})}function Ne(s){return $(this,null,function*(){const t=G();if(t.length===0)return console.log("No pending submissions in queue"),[];console.log(`üì§ Processing ${t.length} pending submission(s)...`);const n=[];for(const a of t){const l=yield W(a,s);n.push(Q({id:a.id},l))}return n})}function Se(s){let t=!1;const n=()=>$(this,null,function*(){if(!t){t=!0;try{yield Ne(s)}catch(l){console.error("Background sync error:",l)}finally{t=!1}}}),a=()=>{console.log("üåê Network reconnected, attempting to sync..."),n()};return window.addEventListener("online",a),n(),()=>{window.removeEventListener("online",a)}}const R={RUNNING:"RUNNING",SUBMITTED:"SUBMITTED"};function ye({questions:s,studentName:t,questionFile:n="questions.json",examConfig:a}){console.log("MCQContainer rendered:",{hasQuestions:!!s,isArray:Array.isArray(s),length:s==null?void 0:s.length,studentName:t,examConfig:a});const l=(a==null?void 0:a.durationSeconds)||60*60,g=(a==null?void 0:a.markPerQuestion)||1.25,r=(a==null?void 0:a.negativeMarking)||.25,x=(a==null?void 0:a.passMark)||40,[i,h]=o.useState(R.RUNNING),[u,b]=o.useState(0),[m,C]=o.useState({}),[k,v]=o.useState(new Set([0])),[M,I]=o.useState(l),[T,N]=o.useState(new Set),[j]=o.useState(Date.now()),[A,y]=o.useState(!1),[_,D]=o.useState({status:"idle",retryCount:0}),U=o.useCallback((c,d)=>{C(p=>z(Q({},p),{[c]:d})),v(p=>new Set([...p,u]))},[u]),B=o.useCallback(c=>{s&&c>=0&&c<s.length&&(b(c),v(d=>new Set([...d,c])))},[s]),J=o.useCallback(()=>{u>0&&b(c=>{const d=c-1;return v(p=>new Set([...p,d])),d})},[u]),H=o.useCallback(()=>{s&&u<s.length-1&&b(c=>{const d=c+1;return v(p=>new Set([...p,d])),d})},[u,s]),V=o.useCallback(()=>{N(c=>{const d=new Set(c);return d.has(u)?d.delete(u):d.add(u),d})},[u]),F=o.useCallback(()=>{if(!s||!Array.isArray(s))return{score:0,correct:0,wrong:0,attempted:0,total:0};let c=0,d=0;return s.forEach(E=>{const w=m[E.id];w&&(w===E.correctOptionId?c++:d++)}),{score:Math.max(c*g-d*r,0),correct:c,wrong:d,attempted:c+d,total:s.length}},[s,m]),O=o.useCallback(()=>$(this,null,function*(){if(i===R.SUBMITTED)return;const c=F(),d={studentName:t,answers:m,score:parseFloat(c.score.toFixed(2)),totalMarks:c.total*g,timestamp:new Date().toISOString(),attempted:c.attempted,correct:c.correct,wrong:c.wrong,pass:c.score>=x,questionFile:n},p=be(d);console.log("üìù Submission queued locally:",p),h(R.SUBMITTED),W({id:p,payload:d,retryCount:0},w=>{D(w),w.status==="success"&&localStorage.removeItem(`mcq_state_${t}`)}).catch(w=>{console.error("Submission error:",w)})}),[i,t,m,s,F,n]);if(o.useEffect(()=>{var d;if(!s||s.length===0)return;const c=localStorage.getItem(`mcq_state_${t}`);if(c)try{const p=JSON.parse(c);C(p.answers||{});const E=Math.max(0,s.length-1);b(Math.min(p.currentIndex||0,E)),I((d=p.timeLeft)!=null?d:l),v(new Set(p.visited||[0])),N(new Set(p.marked||[]))}catch(p){console.error("Failed to load saved state",p)}},[t,s]),o.useEffect(()=>{if(i===R.RUNNING){const c={answers:m,currentIndex:u,timeLeft:M,visited:Array.from(k),marked:Array.from(T)};localStorage.setItem(`mcq_state_${t}`,JSON.stringify(c))}},[m,u,M,k,T,i,t]),o.useEffect(()=>{if(i!==R.RUNNING||M<=0)return;const c=setInterval(()=>{I(d=>d<=1?(O(),0):d-1)},1e3);return()=>clearInterval(c)},[i,M,O]),o.useEffect(()=>{s&&s.length>0&&(u<0||u>=s.length)&&b(0)},[u,s]),o.useEffect(()=>{if(i!==R.RUNNING)return;const c=1*60*1e3,d=5*60*1e3,p=setTimeout(()=>{A||(y(!0),q(t,j).then(()=>{console.log(`${t} marked as pending after 1 minute`)}).catch(w=>console.error("Failed to save pending student (1 min):",w)))},c),E=setInterval(()=>{q(t,j).then(()=>{console.log(`Heartbeat: ${t} is still taking exam`)}).catch(w=>console.error("Failed to send heartbeat:",w))},d);return()=>{clearTimeout(p),clearInterval(E)}},[i,A,j,t]),o.useEffect(()=>Se(d=>{D(d)}),[]),!s||!Array.isArray(s)||s.length===0)return console.error("MCQContainer: Invalid questions array",{questions:s}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"var(--gray-50)"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px",textAlign:"center"},className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px",marginTop:"8px",textAlign:"center"},children:s?Array.isArray(s)?s.length===0?"Questions array is empty":"Unknown error":"Questions is not an array":"Questions is null/undefined"}),e.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",marginTop:"8px"},className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]});if(i===R.SUBMITTED)return e.jsx(fe,{questions:s,answers:m,studentName:t,score:F(),onRestart:()=>window.location.reload(),questionFile:n,submissionStatus:_});const f=Math.max(0,Math.min(u,s.length-1)),S=s[f];if(!S)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx("div",{className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."})});try{return e.jsxs("div",{className:"mcq-container",children:[e.jsx(de,{examName:"MCQ Exam",timeLeft:M,totalQuestions:s.length}),e.jsxs("div",{className:"mcq-content",children:[e.jsx("div",{className:"question-section",children:e.jsx(me,{question:S,questionNumber:f+1,selectedAnswer:m[S.id],onAnswerSelect:U,onPrev:J,onNext:H,canGoPrev:f>0,canGoNext:f<s.length-1,isMarked:T.has(f),onToggleMark:V,onSubmit:O})}),e.jsx(he,{totalQuestions:s.length,currentIndex:f,answers:m,questions:s,visitedQuestions:k,markedQuestions:T,onQuestionJump:B})]}),e.jsx(ee,Q({},_))]})}catch(c){return console.error("MCQContainer render error:",c),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px"},children:[e.jsxs("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:["‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ",c.message]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]})}}function we({onStart:s}){const[t,n]=o.useState("");function a(l){l.preventDefault(),t.trim()&&s(t.trim())}return e.jsx("div",{className:"start-screen",children:e.jsxs("div",{className:"start-card",children:[e.jsx("h1",{className:"bengali",children:"MCQ Exam"}),e.jsxs("div",{className:"exam-info",children:[e.jsx("p",{className:"bengali",children:"‡¶∏‡¶Æ‡¶Ø‡¶º: ‡ß¨‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü | ‡¶Æ‡ßã‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: ‡ßß‡ß¶‡ß¶ | ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®: ‡ßÆ‡ß¶"}),e.jsx("p",{className:"bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï: +‡ßß.‡ß®‡ß´ | ‡¶≠‡ßÅ‡¶≤: -‡ß¶.‡ß®‡ß´ | ‡¶™‡¶æ‡¶∏ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï: ‡ß™‡ß¶"})]}),e.jsxs("form",{onSubmit:a,children:[e.jsx("label",{htmlFor:"student-name",className:"bengali",children:"‡¶®‡¶æ‡¶Æ / ‡¶Ü‡¶á‡¶°‡¶ø"}),e.jsx("input",{id:"student-name",type:"text",value:t,onChange:l=>n(l.target.value),placeholder:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",className:"bengali",autoFocus:!0}),e.jsx("button",{type:"submit",className:"primary-btn bengali",children:"‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®"}),e.jsx("p",{className:"hint bengali",children:"‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á‡•§ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"})]})]})})}class Ie extends ie.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("ErrorBoundary caught error:",t,n)}render(){var t;return this.state.hasError?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:"‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px"},children:(t=this.state.error)==null?void 0:t.message}),e.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}):this.props.children}}function Ae(){const[s,t]=o.useState(""),[n,a]=o.useState([]),[l,g]=o.useState("questions.json"),[r,x]=o.useState(null),[i,h]=o.useState(!0),[u,b]=o.useState(null);o.useEffect(()=>{m()},[]);function m(){return $(this,null,function*(){try{console.log("Loading exam configuration...");const v=yield oe();console.log("Exam config loaded:",v),x(v);const M=v.currentType||"type1",I=v[M],T=I.questionFile;console.log(`Loading questions from /${T} (${I.label})`),g(T);const N=yield fetch(`/${T}`,{cache:"no-store"});if(console.log("Fetch response:",{status:N.status,ok:N.ok}),!N.ok)throw new Error(`Failed to load questions: ${N.status} ${N.statusText}`);const j=yield N.json();if(console.log("Loaded questions data:",{isArray:Array.isArray(j),count:j==null?void 0:j.length}),!Array.isArray(j)||j.length===0)throw new Error("No questions found in file");j.length!==I.totalQuestions&&console.warn(`Warning: Expected ${I.totalQuestions} questions but found ${j.length}`);const A=j.map(y=>({id:y.id,question:y.question,options:Object.entries(y.options).map(([_,D])=>({id:_,text:D})),correctOptionId:y.correctAnswer,explanation:`‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ${y.correctAnswer}. ${y.question}`,hasDiagram:y.hasDiagram||!1,svg_code:y.svg_code||null,subject:y.subject||""}));if(console.log("Transformed questions:",{count:A.length,firstQuestion:A[0]}),A.length===0)throw new Error("No valid questions found after processing");a(A),h(!1)}catch(v){console.error("Error loading questions:",v),b(v.message),h(!1)}})}if(i)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx("div",{children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."})});if(u)return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px",textAlign:"center"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px",marginTop:"8px"},children:u}),e.jsx("button",{onClick:m,style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",marginTop:"16px"},className:"bengali",children:"‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®"})]});if(!s)return e.jsx(we,{onStart:v=>{t(v)}});console.log("ExamPage rendering MCQContainer:",{studentName:s,questionsCount:n.length,examConfig:r,loading:i,error:u});const C=(r==null?void 0:r.currentType)||"type1",k=r==null?void 0:r[C];return e.jsx(Ie,{children:e.jsx(ye,{questions:n,studentName:s,questionFile:l,examConfig:k})})}export{Ae as default};
